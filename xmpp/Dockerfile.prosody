FROM "ubuntu:18.04"

RUN DEBIAN_FRONTEND=noninteractive apt-get update \
  && apt-get install -y --no-install-recommends \
    adduser \
    ca-certificates \
    libevent-2.1-6 \
    libevent-extra-2.1-6 \
    libevent-core-2.1-6 \
    libevent-openssl-2.1-6 \
    libevent-pthreads-2.1-6 \
    libidn11 \
    libssl1.1 \
    lsb-base \
    lua-bitop \
    lua-event \
    lua-expat \
    lua-filesystem \
    lua-sec \
    lua-socket \
    lua-zlib \
    lua5.3 \
    luajit \
    openssl \
    prosody \
    ssl-cert \
  && chown prosody /var/lib/prosody

COPY ./prosody-modules/* /usr/lib/prosody/modules/

VOLUME ["/home/point/ssl", "/var/lib/prosody"]

WORKDIR /var/lib/prosody

EXPOSE 80 443 5222 5269 5347 5280 5281
ENV __FLUSH_LOG yes

COPY ./prosody.sh /prosody.sh
RUN chmod 755 /prosody.sh

CMD ["/prosody.sh"]

